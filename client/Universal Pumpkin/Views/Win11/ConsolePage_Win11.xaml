<page:ConsolePageBase
    x:Class="Universal_Pumpkin.Views.Win11.ConsolePage_Win11"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:page="using:Universal_Pumpkin.Shared.Views"
    xmlns:models="using:Universal_Pumpkin.Models"
    xmlns:helpers="using:Universal_Pumpkin.Helpers"
    xmlns:helpers1="using:Universal_Pumpkin"
    mc:Ignorable="d"
    NavigationCacheMode="Required"
    muxc:BackdropMaterial.ApplyToRootOrPageBackground="True">

    <Page.Resources>
        <helpers1:TimeFormatConverter x:Key="TimeFormatConverter"/>

        <DataTemplate x:Key="InfoTemplate"
                      x:DataType="models:LogEntry">
            <StackPanel Orientation="Horizontal"
                        Margin="0,0,8,0"
                        IsHoldingEnabled="True"
                        IsRightTapEnabled="True"
                        Holding="LogItem_Holding"
                        RightTapped="LogItem_RightTapped">
                <TextBlock Text="{x:Bind Timestamp, Converter={StaticResource TimeFormatConverter}}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Margin="0,0,8,0"
                           FontFamily="Consolas"/>
                <TextBlock FontFamily="Consolas"
                           FontWeight="Bold"
                           Margin="0,0,8,0">
                    <Run Text="{x:Bind Level}"/>
                </TextBlock>
                <TextBlock Text="{x:Bind Message}"
                           TextWrapping="WrapWholeWords"
                           FontFamily="Consolas"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="WarnTemplate"
                      x:DataType="models:LogEntry">
            <StackPanel Orientation="Horizontal"
                        Margin="0,0,8,0"
                        IsHoldingEnabled="True"
                        IsRightTapEnabled="True"
                        Holding="LogItem_Holding"
                        RightTapped="LogItem_RightTapped">
                <TextBlock Text="{x:Bind Timestamp, Converter={StaticResource TimeFormatConverter}}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Margin="0,0,8,0"
                           FontFamily="Consolas"/>
                <TextBlock FontFamily="Consolas"
                           FontWeight="Bold"
                           Foreground="Yellow"
                           Margin="0,0,8,0">
                    <Run Text="{x:Bind Level}"/>
                </TextBlock>
                <TextBlock Text="{x:Bind Message}"
                           TextWrapping="WrapWholeWords"
                           FontFamily="Consolas"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="ErrorTemplate"
                      x:DataType="models:LogEntry">
            <StackPanel Orientation="Horizontal"
                        Margin="0,0,8,0"
                        IsHoldingEnabled="True"
                        IsRightTapEnabled="True"
                        Holding="LogItem_Holding"
                        RightTapped="LogItem_RightTapped">
                <TextBlock Text="{x:Bind Timestamp, Converter={StaticResource TimeFormatConverter}}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Margin="0,0,8,0"
                           FontFamily="Consolas"/>
                <TextBlock FontFamily="Consolas"
                           FontWeight="Bold"
                           Foreground="OrangeRed"
                           Margin="0,0,8,0">
                    <Run Text="{x:Bind Level}"/>
                </TextBlock>
                <TextBlock Text="{x:Bind Message}"
                           TextWrapping="WrapWholeWords"
                           FontFamily="Consolas"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
            </StackPanel>
        </DataTemplate>

        <helpers1:LogTemplateSelector x:Key="LogSelector"
                                      InfoTemplate="{StaticResource InfoTemplate}"
                                      WarnTemplate="{StaticResource WarnTemplate}"
                                      ErrorTemplate="{StaticResource ErrorTemplate}"/>

    </Page.Resources>

    <Grid Padding="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <CommandBar Grid.Row="0"
                    Background="Transparent"
                    DefaultLabelPosition="Right"
                    Margin="-12,-12,-12,0">
            <CommandBar.PrimaryCommands>
                <AppBarButton x:Name="BtnStart"
                              Label="Start"
                              Icon="Play"
                              Click="BtnStart_Click"/>
                <AppBarButton x:Name="BtnStop"
                              Label="Stop"
                              Icon="Stop"
                              Click="BtnStop_Click"
                              Visibility="Collapsed"/>
                <AppBarButton x:Name="BtnRestartApp"
                              Label="Restart App"
                              Icon="Refresh"
                              Click="BtnRestartApp_Click"
                              Visibility="Collapsed"/>
                <AppBarButton x:Name="ResumeAutoScrollButton"
                              Icon="DockBottom"
                              Label="Resume Auto-Scroll"
                              Visibility="Collapsed"
                              Click="ResumeAutoScroll_Click"/>
                <AppBarButton Icon="Find"
                              Label="Search"
                              Click="Search_Click"/>
                <AppBarButton Icon="List"
                              Label="Menu"
                              Click="CommandBarMenu_Click"/>
            </CommandBar.PrimaryCommands>
        </CommandBar>

        <Grid x:Name="StatusGrid"
              Grid.Row="1"
              Margin="0,0,0,12"
              Visibility="Collapsed"
              Background="{ThemeResource LayerFillColorDefaultBrush}"
              BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="8"
              Padding="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0"
                        VerticalAlignment="Center">
                <TextBlock Text="Server Address"
                           FontSize="10"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock x:Name="TxtIpAddress"
                           Text="127.0.0.1"
                           FontWeight="Bold"
                           FontSize="16"
                           IsTextSelectionEnabled="True"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
            </StackPanel>

            <StackPanel Grid.Column="1"
                        Margin="24,0,0,0"
                        VerticalAlignment="Center">
                <TextBlock Text="TPS"
                           FontSize="10"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Right"/>
                <TextBlock x:Name="TxtTPS"
                           Text="20.0"
                           FontWeight="Bold"
                           Foreground="#FF55FF55"
                           HorizontalAlignment="Right"/>
            </StackPanel>

            <StackPanel Grid.Column="2"
                        Margin="24,0,0,0"
                        VerticalAlignment="Center">
                <TextBlock Text="MSPT"
                           FontSize="10"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Right"/>
                <TextBlock x:Name="TxtMSPT"
                           Text="12.50ms"
                           FontWeight="Bold"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                           HorizontalAlignment="Right"/>
            </StackPanel>

            <StackPanel Grid.Column="3"
                        Margin="24,0,0,0"
                        VerticalAlignment="Center">
                <TextBlock Text="Mem"
                           FontSize="10"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Right"/>
                <TextBlock x:Name="TxtRAM"
                           Text="150 MB"
                           FontWeight="Bold"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                           HorizontalAlignment="Right"/>
            </StackPanel>
        </Grid>

        <TextBox x:Name="SearchBox"
                 Grid.Row="2"
                 PlaceholderText="Search logs..."
                 Visibility="Collapsed"
                 Margin="0,0,0,12"
                 TextChanged="SearchBox_TextChanged"/>

        <Grid Grid.Row="3"
              RightTapped="LogBackground_RightTapped"
              Holding="LogBackground_Holding">

            <ListView x:Name="LogList"
                      ItemsSource="{x:Bind _vm.LogItems}"
                      ItemTemplateSelector="{StaticResource LogSelector}"
                      SelectionMode="Extended"
                      IsItemClickEnabled="False"
                      ScrollViewer.VerticalScrollBarVisibility="Visible"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                      ScrollViewer.HorizontalScrollMode="Disabled"
                      ScrollViewer.IsHorizontalRailEnabled="False"
                      Background="{ThemeResource LayerFillColorDefaultBrush}"
                      BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                      BorderThickness="1"
                      CornerRadius="8"
                      KeyDown="LogList_KeyDown">
                <ListView.ItemContainerTransitions>
                    <TransitionCollection>
                        <EntranceThemeTransition FromVerticalOffset="20"
                                                 IsStaggeringEnabled="True"/>
                    </TransitionCollection>
                </ListView.ItemContainerTransitions>

                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsStackPanel
                            Orientation="Vertical"
                            VirtualizingStackPanel.VirtualizationMode="Recycling"/>
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
            </ListView>

            <muxc:InfoBar x:Name="StatusInfoBar"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Top"
                          Margin="0,0,0,12"
                          IsOpen="False"
                          IsClosable="True"
                          Padding="12"
                          CornerRadius="8"
                          Background="{ThemeResource LayerFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                          BorderThickness="1"/>

            <ProgressRing x:Name="LoadingSpinner"
                          IsActive="True"
                          Visibility="Collapsed"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Width="40"
                          Height="40"/>
        </Grid>

        <Grid Row="4"
              x:Name="CommandInputContainer"
              HorizontalAlignment="Stretch"
              Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0"
                  VerticalAlignment="Center">

                <AutoSuggestBox x:Name="BoxCommand"
                                PlaceholderText="Enter server command..."
                                UpdateTextOnSelect="False"
                                TextChanged="BoxCommand_TextChanged"
                                QuerySubmitted="BoxCommand_QuerySubmitted"
                                SuggestionChosen="BoxCommand_SuggestionChosen"
                                KeyDown="BoxCommand_KeyDown"
                                GotFocus="BoxCommand_GotFocus"
                                LostFocus="BoxCommand_LostFocus"
                                HorizontalAlignment="Stretch"
                                Height="32"
                                Canvas.ZIndex="0"/>

                <TextBlock x:Name="GhostText"
                           Margin="12,0,32,0"
                           VerticalAlignment="Center"
                           IsHitTestVisible="False"
                           FontSize="14"
                           TextWrapping="NoWrap"
                           Opacity="0.6"
                           Canvas.ZIndex="1"
                           Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"/>
            </Grid>

            <Button x:Name="BtnSend"
                    Grid.Column="1"
                    Content="Send"
                    Margin="8,0,0,0"
                    VerticalAlignment="Stretch"
                    Padding="16,0,16,0"
                    Height="32"
                    Click="BtnSend_Click"/>
        </Grid>
    </Grid>
</page:ConsolePageBase>