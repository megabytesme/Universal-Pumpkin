<Page
    x:Class="Universal_Pumpkin.Views.Win11.SettingsPage_Win11"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    muxc:BackdropMaterial.ApplyToRootOrPageBackground="True">

    <ScrollViewer Padding="20">
        <StackPanel Spacing="16"
                    MaxWidth="800"
                    HorizontalAlignment="Center">

            <TextBlock Text="Server Configuration"
                       Style="{ThemeResource TitleTextBlockStyle}"
                       Margin="0,0,0,8"/>

            <muxc:InfoBar Title="Restart Required"
                          Message="Changes to these settings require an app restart to take effect."
                          Severity="Warning"
                          IsOpen="True"
                          IsClosable="False"/>

            <muxc:Expander HorizontalAlignment="Stretch"
                           IsExpanded="True">
                <muxc:Expander.Header>
                    <StackPanel Orientation="Horizontal"
                                Spacing="12">
                        <FontIcon Glyph="&#xE790;"
                                  FontFamily="Segoe MDL2 Assets"/>
                        <TextBlock Text="Appearance"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </muxc:Expander.Header>

                <StackPanel Spacing="12">
                    <ToggleSwitch x:Name="SwModernUI"
                                  Header="Use Windows 11 Visuals"
                                  Toggled="SwModernUI_Toggled"/>
                    <TextBlock Text="Requires app restart to apply changes."
                               FontSize="10"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
            </muxc:Expander>

            <!-- 1. Networking -->
            <muxc:Expander HorizontalAlignment="Stretch"
                           IsExpanded="False">
                <muxc:Expander.Header>
                    <StackPanel Orientation="Horizontal"
                                Spacing="12">
                        <FontIcon Glyph="&#xE7F8;"
                                  FontFamily="Segoe MDL2 Assets"/>
                        <TextBlock Text="Networking &amp; Protocols"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </muxc:Expander.Header>

                <StackPanel Spacing="12">
                    <ToggleSwitch x:Name="SwJava"
                                  Header="Java Edition"
                                  Toggled="Setting_Toggled"
                                  Tag="java_edition"/>
                    <TextBox x:Name="TxtJavaAddr"
                             Header="Java Address"
                             TextChanged="Setting_TextChanged"
                             Tag="java_edition_address"/>

                    <ToggleSwitch x:Name="SwBedrock"
                                  Header="Bedrock Edition"
                                  Toggled="Setting_Toggled"
                                  Tag="bedrock_edition"/>
                    <TextBox x:Name="TxtBedrockAddr"
                             Header="Bedrock Address"
                             TextChanged="Setting_TextChanged"
                             Tag="bedrock_edition_address"/>

                    <ToggleSwitch x:Name="SwOnline"
                                  Header="Online Mode (Mojang Auth)"
                                  Toggled="Setting_Toggled"
                                  Tag="online_mode"/>
                    <ToggleSwitch x:Name="SwEncrypt"
                                  Header="Encryption"
                                  Toggled="Setting_Toggled"
                                  Tag="encryption"/>
                    <ToggleSwitch x:Name="SwScrub"
                                  Header="Scrub IPs in Logs"
                                  Toggled="Setting_Toggled"
                                  Tag="scrub_ips"/>

                    <MenuFlyoutSeparator/>
                    <TextBlock Text="Advanced Features"
                               FontWeight="SemiBold"/>
                    <ToggleSwitch x:Name="SwLan"
                                  Header="LAN Broadcast"
                                  Toggled="Feature_Toggled"
                                  Tag="networking.lan_broadcast|enabled"/>
                    <ToggleSwitch x:Name="SwQuery"
                                  Header="Query Protocol"
                                  Toggled="Feature_Toggled"
                                  Tag="networking.query|enabled"/>
                </StackPanel>
            </muxc:Expander>

            <!-- 2. Gameplay -->
            <muxc:Expander HorizontalAlignment="Stretch">
                <muxc:Expander.Header>
                    <StackPanel Orientation="Horizontal"
                                Spacing="12">
                        <FontIcon Glyph="&#xE7C1;"
                                  FontFamily="Segoe MDL2 Assets"/>
                        <TextBlock Text="Gameplay"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </muxc:Expander.Header>

                <StackPanel Spacing="12">
                    <TextBox x:Name="TxtMotd"
                             Header="MOTD"
                             TextChanged="Setting_TextChanged"
                             Tag="motd"/>

                    <ComboBox x:Name="CmbGamemode"
                              Header="Default Gamemode"
                              SelectionChanged="Setting_ComboChanged"
                              Tag="default_gamemode"
                              HorizontalAlignment="Stretch">
                        <ComboBoxItem Content="Survival"/>
                        <ComboBoxItem Content="Creative"/>
                        <ComboBoxItem Content="Adventure"/>
                        <ComboBoxItem Content="Spectator"/>
                    </ComboBox>

                    <ToggleSwitch x:Name="SwForceGame"
                                  Header="Force Gamemode"
                                  Toggled="Setting_Toggled"
                                  Tag="force_gamemode"/>

                    <ComboBox x:Name="CmbDifficulty"
                              Header="Difficulty"
                              SelectionChanged="Setting_ComboChanged"
                              Tag="default_difficulty"
                              HorizontalAlignment="Stretch">
                        <ComboBoxItem Content="Peaceful"/>
                        <ComboBoxItem Content="Easy"/>
                        <ComboBoxItem Content="Normal"/>
                        <ComboBoxItem Content="Hard"/>
                    </ComboBox>

                    <ToggleSwitch x:Name="SwHardcore"
                                  Header="Hardcore"
                                  Toggled="Setting_Toggled"
                                  Tag="hardcore"/>
                    <ToggleSwitch x:Name="SwNether"
                                  Header="Allow Nether"
                                  Toggled="Setting_Toggled"
                                  Tag="allow_nether"/>
                    <TextBox x:Name="TxtSeed"
                             Header="Level Seed"
                             TextChanged="Setting_TextChanged"
                             Tag="seed"/>
                </StackPanel>
            </muxc:Expander>

            <!-- 3. Performance -->
            <muxc:Expander HorizontalAlignment="Stretch">
                <muxc:Expander.Header>
                    <StackPanel Orientation="Horizontal"
                                Spacing="12">
                        <FontIcon Glyph="&#xE9F5;"
                                  FontFamily="Segoe MDL2 Assets"/>
                        <TextBlock Text="Performance &amp; Limits"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </muxc:Expander.Header>

                <StackPanel Spacing="12">
                    <TextBox x:Name="TxtMaxPlayers"
                             Header="Max Players"
                             InputScope="Number"
                             TextChanged="Setting_TextChanged"
                             Tag="max_players"/>
                    <TextBox x:Name="TxtTPS"
                             Header="Target TPS"
                             InputScope="Number"
                             TextChanged="Setting_TextChanged"
                             Tag="tps"/>

                    <TextBlock Text="View Distance (Chunks)"/>
                    <Slider x:Name="SldView"
                            Minimum="2"
                            Maximum="32"
                            ValueChanged="SldView_ValueChanged"/>
                    <TextBlock x:Name="TxtViewVal"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                    <TextBlock Text="Simulation Distance (Chunks)"/>
                    <Slider x:Name="SldSim"
                            Minimum="2"
                            Maximum="32"
                            ValueChanged="SldSim_ValueChanged"/>
                    <TextBlock x:Name="TxtSimVal"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
            </muxc:Expander>

            <!-- 4. Security -->
            <muxc:Expander HorizontalAlignment="Stretch">
                <muxc:Expander.Header>
                    <StackPanel Orientation="Horizontal"
                                Spacing="12">
                        <FontIcon Glyph="&#xE72E;"
                                  FontFamily="Segoe MDL2 Assets"/>
                        <TextBlock Text="Security"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </muxc:Expander.Header>

                <StackPanel Spacing="12">
                    <TextBox x:Name="TxtOpLevel"
                             Header="OP Permission Level (1-4)"
                             InputScope="Number"
                             TextChanged="Setting_TextChanged"
                             Tag="op_permission_level"/>
                    <ToggleSwitch x:Name="SwWhite"
                                  Header="Enable Whitelist"
                                  Toggled="Setting_Toggled"
                                  Tag="white_list"/>
                    <ToggleSwitch x:Name="SwEnforceWhite"
                                  Header="Enforce Whitelist"
                                  Toggled="Setting_Toggled"
                                  Tag="enforce_whitelist"/>
                    <ToggleSwitch x:Name="SwChatReport"
                                  Header="Allow Chat Reports"
                                  Toggled="Setting_Toggled"
                                  Tag="allow_chat_reports"/>
                </StackPanel>
            </muxc:Expander>

            <!-- 5. Maintenance -->
            <muxc:Expander HorizontalAlignment="Stretch">
                <muxc:Expander.Header>
                    <StackPanel Orientation="Horizontal"
                                Spacing="12">
                        <FontIcon Glyph="&#xE8B7;"
                                  FontFamily="Segoe MDL2 Assets"/>
                        <TextBlock Text="Maintenance &amp; Data"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </muxc:Expander.Header>

                <StackPanel Spacing="12">
                    <StackPanel Orientation="Horizontal"
                                Spacing="8">
                        <TextBlock Text="Total Data Size:"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock x:Name="TxtWorldSize"
                                   Text="Calculating..."
                                   FontWeight="Bold"/>
                    </StackPanel>

                    <Grid ColumnSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button x:Name="BtnBackup"
                                Content="Backup to Zip"
                                HorizontalAlignment="Stretch"
                                Click="BtnBackup_Click"/>
                        <Button x:Name="BtnRestore"
                                Grid.Column="1"
                                Content="Restore Zip"
                                HorizontalAlignment="Stretch"
                                Click="BtnRestore_Click"/>
                    </Grid>

                    <Button x:Name="BtnReset"
                            Content="Reset World Data (Delete Level)"
                            Background="DarkRed"
                            Foreground="White"
                            Click="BtnReset_Click"
                            HorizontalAlignment="Stretch"/>
                    <Button Content="Open LocalState Folder"
                            Click="BtnOpen_Click"
                            HorizontalAlignment="Stretch"/>
                </StackPanel>
            </muxc:Expander>

            <!-- 6. About -->
            <muxc:Expander HorizontalAlignment="Stretch"
                           IsExpanded="True">
                <muxc:Expander.Header>
                    <StackPanel Orientation="Horizontal"
                                Spacing="12">
                        <FontIcon Glyph="&#xE946;"
                                  FontFamily="Segoe MDL2 Assets"/>
                        <TextBlock Text="About"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </muxc:Expander.Header>

                <StackPanel Spacing="8">
                    <Button Content="About Universal Pumpkin"
                            Click="AboutButton_Click"
                            HorizontalAlignment="Stretch"/>
                    <Button Content="Disclaimer &amp; Legal"
                            Click="DisclaimerButton_Click"
                            HorizontalAlignment="Stretch"/>
                </StackPanel>
            </muxc:Expander>

        </StackPanel>
    </ScrollViewer>
</Page>